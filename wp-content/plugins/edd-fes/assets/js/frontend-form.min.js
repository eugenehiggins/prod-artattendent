!function(e){var t,i,a={init:function(){e(".fes-form").on("click","img.fes-clone-field",this.cloneField),e(".fes-form").on("click","img.fes-remove-field",this.removeField),e(".fes-ajax-form").on("submit",this.formSubmit),e(".fes-fields").on("click","a.fes-feat-image-btn",this.featuredImage.addImage),e(".fes-fields").on("click","a.fes-remove-feat-image",this.featuredImage.removeImage),e(".fes-fields").on("click","a.fes-avatar-image-btn",this.avatarImage.addImage),e(".fes-fields").on("click","a.fes-remove-avatar-image",this.avatarImage.removeImage),e(".fes-fields").on("click","a.upload_file_button",this.fileDownloadable),e(".fes-fields").on("click","a.insert-file-row",function(t){t.preventDefault();var i=e(this).attr("id"),a=e("#fes-upload-max-files-"+i).val(),s=e(".fes-variations-list-"+i),r=s.find(".fes-single-variation:last").clone();delete r[1],r.length=1;var n=s.find(".fes-single-variation").length;return n+1>a&&0!=a?alert(fes_form.too_many_files_pt_1+a+fes_form.too_many_files_pt_2):(r.find("input, select, textarea").val(""),r.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(n)+"]"),e(this).attr("name",t).attr("id",t),r.insertBefore("#"+i)}),!1)}),e(".fes-fields").on("click","a.edd-fes-delete",function(t){t.preventDefault();var i=e(this).parents(".fes-single-variation");return 1==e(this).parents("[class^=fes-variations-list-]").find(".fes-single-variation").length?(i.find("input, select, textarea").val(""),!1):(i.remove(),!1)})},avatarImage:{addImage:function(t){t.preventDefault();var a=e(this);i?i.open():((i=wp.media({title:fes_form.avatar_title,button:{text:fes_form.avatar_button},library:{type:"image"}})).on("select",function(){i.state().get("selection").map(function(e){e=e.toJSON(),a.siblings("input.fes-avatar-image-id").val(e.id);var t=a.closest(".instruction-inside"),i=t.siblings(".image-wrap");i.find("img").attr("src",e.url),t.addClass("fes-hide").hide(),i.removeClass("fes-hide").show()})}),i.open())},removeImage:function(t){t.preventDefault();var i=e(this).closest(".image-wrap"),a=i.siblings(".instruction-inside");a.find("input.fes-avatar-image-id").val("0"),i.addClass("fes-hide").hide(),a.removeClass("fes-hide").show()}},fileDownloadable:function(t){t.preventDefault();var i,a=e(this);i?i.open():((i=wp.media({title:fes_form.file_title,button:{text:fes_form.file_button},multiple:!1})).on("open",function(){var t=a.closest("tr").find("input.fes-file-value").attr("data-formid"),i=a.closest("tr").find("input.fes-file-value").attr("data-fieldname");e.post(fes_form.ajaxurl,{action:"fes_turn_on_file_filter",formid:t,name:i},function(e){})}),i.on("close",function(){var t=a.closest("tr").find("input.fes-file-value").attr("data-formid"),i=a.closest("tr").find("input.fes-file-value").attr("data-fieldname");e.post(fes_form.ajaxurl,{action:"fes_turn_off_file_filter",formid:t,name:i},function(e){})}),i.on("select",function(){i.state().get("selection").map(function(e){e=e.toJSON(),a.closest("tr").find("input.fes-file-value").val(e.url)})}),i.open())},featuredImage:{addImage:function(i){i.preventDefault();var a=e(this);t?t.open():((t=wp.media({title:fes_form.feat_title,button:{text:fes_form.feat_button},library:{type:"image"}})).on("select",function(){t.state().get("selection").map(function(e){e=e.toJSON(),a.siblings("input.fes-feat-image-id").val(e.id);var t=a.closest(".instruction-inside"),i=t.siblings(".image-wrap");i.find("img").attr("src",e.url),t.addClass("fes-hide"),i.removeClass("fes-hide")})}),t.open())},removeImage:function(t){t.preventDefault();var i=e(this).closest(".image-wrap"),a=i.siblings(".instruction-inside");a.find("input.fes-feat-image-id").val("0"),i.addClass("fes-hide"),a.removeClass("fes-hide")}},cloneField:function(t){t.preventDefault();var i=e(this).closest("tr"),a=i.clone(),s=i.parent().find("tr"),r=highest=0;s.each(function(){var t=e(this).data("key");parseInt(t)>highest&&(highest=t)}),r=highest+1,a.attr("data-key",parseInt(r)),a.find(":checked").attr("checked",""),a.find("input, select, textarea").val(""),a.find("input, select, textarea").each(function(){var t=e(this).attr("name");t=t.replace(/\[(\d+)\]/,"["+parseInt(r)+"]"),e(this).attr("name",t).attr("id",t)}),i.after(a)},removeField:function(){var t=e(this).closest("tr");t.siblings().andSelf().length>1&&t.remove()},formSubmit:function(t){t.preventDefault();var i=e(this),s=i.find("input[type=submit]:focus"),r=i.find(".fes-save-as-draft"),n=a.validateForm(i);if("fes-save-as-draft"==s.attr("id")&&(n+="&draft=true"),n){var o={lines:13,length:11,width:5,radius:17,corners:1,rotate:0,color:"#FFF",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"fes_spinner",zIndex:2e9,top:"auto",left:"auto"};""!==fes_form.loading_icon&&(o.icon=fes_form.loading_icon);var f=document.createElement("div");if(document.body.appendChild(f),""!=fes_form.loading_icon)d=fesSpinner({text:fes_form.loadingtext,icon:fes_form.loading_icon});else var l=new Spinner(o).spin(f),d=fesSpinner({text:fes_form.loadingtext,spinner:l});s.attr("disabled","disabled").addClass("button-primary-disabled"),r.attr("disabled","disabled").addClass("button-primary-disabled"),e.post(fes_form.ajaxurl,n,function(e){if(e.success){var t="",r="";t=e.title?e.title:fes_form.successtitle,r=e.message?e.message:fes_form.successmessage,e.skipswal?(d.hide(),"#"!==e.redirect_to&&(window.location=e.redirect_to)):(d.hide(),swal({title:t,text:r,html:!0,allowEscapeKey:!1,type:"success"},function(){"#"!==e.redirect_to?window.location.href=e.redirect_to:(s.removeClass("button-primary-disabled"),i.find("span.fes-loading").remove(),s.removeAttr("disabled"))}))}else{var n=e.errors;if(void 0!==n&&a.hasItems(n)>0)for(var o in n)a.markError(i,o,n[o]);var t="",r="";t=e.title?e.title:fes_form.errortitle,r=e.message?e.message:fes_form.errormessage,d.hide(),swal({title:t,text:r,html:!0,type:"error"}),s.removeAttr("disabled")}s.removeClass("button-primary-disabled"),i.find("span.fes-loading").remove()}).fail(function(t,a,r){var n="",o="";n=fes_form.ajaxerrortitle,o=e(t.responseText).text(),console.log(o),o=o.substring(0,o.indexOf("Call Stack")),d.hide(),swal({title:n,text:o,html:!0,type:"error"}),s.removeAttr("disabled"),s.removeClass("button-primary-disabled"),i.find("span.fes-loading").remove()})}},hasItems:function(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},validateForm:function(t){a.removeErrors(t);var i,s=t.serialize(),r=[];return e(".fes-rich-validation").each(function(t,a){i=e(a).data("id"),val=e.trim(tinyMCE.get(i).getContent()),r.push(i+"="+encodeURIComponent(val))}),s=s+"&"+r.join("&")},markError:function(e,t,i){e.find(".fes-el."+t).append('<div class="edd_errors edd-alert edd-alert-error fes-form-field-error" style="margin-bottom: 0px"><p class="edd_error">'+i+"</p></div>")},removeErrors:function(t){e(t).find(".fes-form-field-error").remove()}};e(function(){a.init()})}(jQuery);