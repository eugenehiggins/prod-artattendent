(function(c,a,d,e){var b={};b.init=function(){b.compare_temp_2=c.eddMetrics.compare_string_2;b.revenue=c.eddMetrics.revenue;b.downloads=c.eddMetrics.downloads;
b.doCal();};b.doCal=function(){var f=new Calendar({element:d(".metrics-datepicker"),presets:[{label:"Last 30 days",start:moment().subtract(29,"days"),end:moment()},{label:"This month",start:moment().startOf("month"),end:moment().endOf("month")},{label:"Last month",start:moment().subtract(1,"month").startOf("month"),end:moment().subtract(1,"month").endOf("month")},{label:"Last 7 days",start:moment().subtract(6,"days"),end:moment()},{label:"Last 3 months",start:moment(this.latest_date).subtract(3,"month").startOf("month"),end:moment(this.latest_date).subtract(1,"month").endOf("month")}],earliest_date:"January 1, 2006",latest_date:moment(),start_date:moment().subtract(29,"days"),end_date:moment(),callback:b.callback});
f.calendarSaveDates();};b.callback=function(){var i=moment(this.start_date).format("LL"),f=moment(this.end_date).format("LL");var g={action:"metrics_batch_1",start:i,end:f};
var h='<div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div>';
d(".edd-metrics-box h2").html(h);d(".edd-metrics-box .bottom-text span").html("").removeClass();if(d(this.element[0]).hasClass("metrics-detail")){d(".edd-metrics-chart-wrapper").append(h);
d.post(c.ajaxurl,g,b.detailResponse).then(function(){g.action="metrics_batch_2";d.post(c.ajaxurl,g,b.detailResponse_2);}).fail(function(){console.warn("ajax error");
});}else{d.post(c.ajaxurl,g,b.dashResponse).then(function(){g.action="metrics_batch_2";d.post(c.ajaxurl,g,b.batch2response);}).fail(function(){console.warn("ajax error");
});}};b.dashResponse=function(f){var h=JSON.parse(f);var g=c.eddMetrics.compare_string+" "+h.dates.num_days+" "+c.eddMetrics.days;d("#revenue").html(h.earnings.total);
d("#revenue-compare span").html(h.earnings.compare.percentage+g).removeClass().addClass(h.earnings.compare.classes);d("#sales").html(h.sales.count);d("#sales-compare span").html(h.sales.compare.percentage+g).removeClass().addClass(h.sales.compare.classes);
d("#avgpercust").html(h.earnings.avgpercust.total);d("#avgpercust-compare span").html(h.earnings.avgpercust.compare.percentage+g).removeClass().addClass(h.earnings.avgpercust.compare.classes);
d("#refunds").html(h.earnings.refunds.count);d("#refund-amount").html(h.earnings.refunds.losses);d("#refunds-compare span").html(h.earnings.refunds.compare.percentage+g).removeClass().addClass(h.earnings.refunds.compare.classes);
};b.batch2response=function(f){var h=JSON.parse(f);var g=c.eddMetrics.compare_string+" "+h.dates.num_days+" "+c.eddMetrics.days;d("#earnings-today").html(h.earnings.detail.today);
if(d("#renewals").length){d("#renewals").html(h.renewals.count);d("#renewal-amount").html(h.renewals.earnings);d("#renewals-compare span").html(h.renewals.compare.percentage+g).removeClass().addClass(h.renewals.compare.classes);
}if(d("#subscriptions").length){d("#subscriptions").html(h.subscriptions.number.count);d("#subscriptions-compare span").html(h.subscriptions.number.compare.percentage+g).removeClass().addClass(h.subscriptions.number.compare.classes);
d("#recurring-revenue").html(h.subscriptions.earnings.total);d("#recurring-revenue-30").html(h.subscriptions.earnings30);}d("#discounts").html(h.discounts.now.amount);
d("#discounts-count").html(h.discounts.now.count);d("#discounts-compare span").html(h.discounts.compare.percentage+g).removeClass().addClass(h.discounts.compare.classes);
if(d("#commissions").length){d("#commissions").html(h.commissions.count);d("#commissions-amount").html(h.commissions.earnings);}};b.detailResponse=function(f){var h=JSON.parse(f);
var g=b.getQueryVariable("metric");switch(g){case"revenue":d("#revenue").html(h.earnings.total);d("#revenue-compare span").html(h.earnings.compare.percentage+b.compare_temp_2).removeClass().addClass(h.earnings.compare.classes);
d(".detail-compare-first").html(h.earnings.compare.total);d("#monthly h2").html(h.earnings.avgmonthly.earnings);d("#new-customers h2").html(h.earnings.avgpercust.current_customers);
d("#new-customers span").html("This period");d(".detail-compare-first").html(h.earnings.compare.total);d("#box-4 .bottom-text span").html(h.earnings.compare.percentage+"%");
break;case"renewals":break;default:}b.doLineChart(h.lineChart);d(".edd-metrics-chart-wrapper #circleG").remove();};b.detailResponse_2=function(f){var h=JSON.parse(f);
var g=b.getQueryVariable("metric");switch(g){case"revenue":d("#revenue-6mocompare span").html(h.earnings.detail.sixmoago.compare+b.compare_temp_2).removeClass().addClass(h.earnings.detail.sixmoago.classes);
d(".detail-compare-second").html(h.earnings.detail.sixmoago.total);d(".detail-compare-third").html(h.earnings.detail.twelvemoago.total);d("#revenue-12mocompare span").html(h.earnings.detail.twelvemoago.compare+b.compare_temp_2).removeClass().addClass(h.earnings.detail.twelvemoago.classes);
d("#earnings-today h2").html(h.earnings.detail.today);d("#earnings-this-month h2").html(h.earnings.detail.this_month);d("#renewal-rate h2").html(h.yearly_renewal_rate.percent+"%");
d("#yearly-renewal-compare span").html("Last "+h.yearly_renewal_rate.period+" days");d("#box-5 .bottom-text span").html(h.earnings.detail.sixmoago.compare+"%");
d(".detail-compare-second").html(h.earnings.detail.sixmoago.total);d(".detail-compare-third").html(h.earnings.detail.twelvemoago.total);break;case"renewals":break;
default:}b.doDownloadChart(h.pieChart);b.doGatewayChart(h.earnings.gateways);};b.getQueryVariable=function(f){var h=c.location.search.substring(1);var j=h.split("&");
for(var g=0;g<j.length;g++){var k=j[g].split("=");if(k[0]==f){return k[1];}}return(false);};b.doLineChart=function(g){if(b.lineChart){b.lineChart.destroy();
}var h={labels:g.labels,datasets:[{label:b.revenue,fill:true,lineTension:0.1,backgroundColor:"rgba(0,115,170,.2)",borderColor:"#0073aa",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"#0073aa",pointBackgroundColor:"#fff",pointBorderWidth:2,pointHoverRadius:5,pointHoverBackgroundColor:"#0073aa",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,data:g.earnings,spanGaps:false},]};
var f=a.getElementById("metrics-line-chart");b.lineChart=new Chart(f,{type:"line",data:h,options:{scales:{xAxes:[{display:false,stacked:true}],}}});};b.doDownloadChart=function(g){if(b.downloadChart){b.downloadChart.destroy();
}var h={labels:g.labels,datasets:[{label:b.downloads,data:g.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]};
var f=a.getElementById("metrics-piechart-by-download");b.downloadChart=new Chart(f,{type:"pie",data:h});};b.doGatewayChart=function(g){if(b.gatewayChart){b.gatewayChart.destroy();
}var h={labels:g.labels,datasets:[{label:b.downloads,data:g.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]};
var f=a.getElementById("metrics-piechart-by-gateway");b.gatewayChart=new Chart(f,{type:"pie",data:h});};jQuery(a).ready(b.init);})(window,document,jQuery);
